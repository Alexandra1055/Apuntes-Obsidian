## Amazon EBS
Son disco duros elásticos, que pueden variar dependiendo de lo que necesitemos.
# Amazon S3 → **Buckets → Create bucket** (qué elegir y por qué)

## Nombre del bucket
- **Elige:** un nombre **globalmente único**, en **minúsculas** y **sin espacios** (ej.: `acfn-lab-usuario123`).
- **Por qué:** los nombres son **únicos a nivel global** y **compatibles con DNS**.

## Región
- **Elige:** la **misma Región** donde está tu instancia **EC2** (ej.: `us-east-1`).
- **Por qué:** coherencia geográfica y **menores costes** de transferencia. S3 replica dentro de la Región elegida.

## Block Public Access
- **Elige:** **Bloquear todo el acceso público** → **ON**.
- **Por qué:** por defecto, mantener datos **no públicos** es lo más seguro para un lab.

## Versioning (opcional)
- **Elige:** **Desactivado** para el lab (puedes activarlo si quieres conservar versiones).
- **Por qué:** es útil en proyectos reales, **no necesario** para este lab.

## Encryption
- **Elige:** **Server-Side Encryption (SSE-S3)** por defecto.
- **Por qué:** cifrado en reposo **gestionado** y suficiente para prácticas.

## Tags (opcional)
- **Elige:** por ejemplo `Name=lab-s3`.
- **Por qué:** **organización** y posibles criterios de corrección por etiqueta.

**Crear bucket**.

> [!note] Recordatorio rápido
> S3 = **objetos** (archivos como “objetos” dentro de buckets) con durabilidad “11 nueves” y acceso HTTP(s).  
> EBS = **bloques** (disco) que se **monta** en EC2; baja latencia; **replicado** en su AZ.  
> **Snapshots** EBS = copias punto-en-tiempo almacenadas en **S3** y reutilizables.

---

# Lab EBS — Resumen

1. Crear un **volumen EBS** (1 GiB, **gp2**) en la **misma AZ** que tu EC2.  
2. **Adjuntarlo** a la instancia.  
3. En Linux: **formatear** (ext3), **montar** y **persistir** en `/etc/fstab`.  
4. Crear **snapshot** del volumen.  
5. Crear **nuevo volumen** desde la snapshot, **adjuntar** y **comprobar** datos.

> [!hint] Conceptos clave
> EBS = bloques persistentes replicados dentro de su **AZ**.  
> Snapshots = copias en **S3**, incrementales por **bloques en uso**, copiables entre **regiones**.

---

# Volumen EBS

> [!warning] Si el lab corrige por valores exactos
> Usa los nombres y rutas tal cual:  
> volumen **“My Volume”**, snapshot **“My Snapshot”**, puntos de montaje **`/mnt/data-store`** y **`/mnt/data-store2`**, **ext3** y **`/dev/sdf`** en `fstab`.

## 1) Crear volumen EBS
**Ruta:** EC2 → Volúmenes → **Crear volumen**
- **Tipo:** General Purpose SSD (**gp2**)  
- **Tamaño:** **1 GiB**  
- **AZ:** la **misma** que tu instancia (ej.: `us-east-1a`)  
- **Tags:** `Name=My Volume`  
- **Crear**

## 2) Adjuntar a la instancia
**Acción:** Volúmenes → selecciona **My Volume** → Acciones → **Asociar volumen**
- **Instancia:** `Lab`  
- **Dispositivo:** **`/dev/sdf`**  
- **Asociar**

> [!note] Nota Linux
> El kernel puede exponerlo como **`/dev/xvdf`** internamente.

## 3) Conectarte por EC2 Instance Connect
**EC2 → tu instancia → Connect → EC2 Instance Connect → Connect**.

## 4) Dentro de la instancia (Linux)
```bash
# Ver almacenamiento actual
df -h

# Crear sistema de ficheros ext3 en el nuevo dispositivo:
sudo mkfs -t ext3 /dev/sdf

# Crear punto de montaje y montar:
sudo mkdir -p /mnt/data-store
sudo mount /dev/sdf /mnt/data-store

# Persistir en /etc/fstab (el enunciado pide /dev/sdf):
echo "/dev/sdf   /mnt/data-store ext3 defaults,noatime 1 2" | sudo tee -a /etc/fstab

# Comprobar:
cat /etc/fstab
df -h

# Probar escritura:
sudo sh -c 'echo some text has been written > /mnt/data-store/file.txt'
cat /mnt/data-store/file.txt
```

> [!caution] Alternativa práctica (no para exámenes que validan literal)
> En algunas AMIs modernas, es preferible usar el **UUID** del sistema de ficheros o `/dev/xvdf` en `fstab` para evitar mapeos variables de nombre.  
> En este lab, sigue **`/dev/sdf`** tal cual.

## 5) Crear snapshot del volumen
**EC2 → Volúmenes →** selecciona **My Volume** → Acciones → **Crear instantánea**  
- **Tag:** `Name=My Snapshot` → **Crear**

Ir a **Instantáneas** y esperar **Completed**.

## 6) Eliminar el archivo de prueba en el volumen original
```bash
sudo rm /mnt/data-store/file.txt
ls /mnt/data-store/
```

## 7) Crear volumen nuevo desde la snapshot
**EC2 → Instantáneas →** selecciona **My Snapshot** → Acciones → **Crear volumen a partir de una instantánea**
- **AZ:** la **misma** de la instancia  
- **Tag:** `Name=Restored Volume`  
- **Crear**

## 8) Adjuntar el volumen restaurado
**EC2 → Volúmenes →** selecciona **Restored Volume** → Acciones → **Asociar volumen**
- **Instancia:** `Lab`  
- **Dispositivo:** **`/dev/sdg`**  
- **Asociar**

## 9) Montar y comprobar en la instancia
```bash
sudo mkdir -p /mnt/data-store2
sudo mount /dev/sdg /mnt/data-store2
ls /mnt/data-store2/
# Deberías ver el .txt que existía cuando hiciste la snapshot
```

---

## Apéndice — Comandos rápidos (chuleta)

```bash
# S3: crear bucket (consola)
# - Nombre único, Región = EC2, Block Public Access ON, SSE-S3, tags opcionales.

# EBS: crear volumen gp2 1 GiB en misma AZ, adjuntar /dev/sdf
sudo mkfs -t ext3 /dev/sdf
sudo mkdir -p /mnt/data-store
sudo mount /dev/sdf /mnt/data-store
echo "/dev/sdf   /mnt/data-store ext3 defaults,noatime 1 2" | sudo tee -a /etc/fstab

# Snapshot y restauración (consola)
# - Crear snapshot de "My Volume"
# - Crear "Restored Volume" desde snapshot, adjuntar /dev/sdg
sudo mkdir -p /mnt/data-store2
sudo mount /dev/sdg /mnt/data-store2
```
